# Visual Attention for Event Cameras based on Spiking Neural Networks

This work consists in the adaptation of the Matlab code produced by Bernert and Yvert (2019) to the DVS128 Gesture dataset. 
The data is imported from the Python library `tonic` and translated in a CSV file comprehensible by the Matlab code thanks to the script `transform_DVS_Gesture.py`.

## How to run the script ? 

### To run it manually 

1) Import one or more random samples from specific categories of DVS128 Gesture dataset using tonic by running the command line :
   `transform_DVS_Gesture.py cat1 cat2 etc`  
   The arguments cat1, cat2, etc specify the categories to import. 
   If a category is specified more than one time, tonic will import different samples from this category.
2) Launch Matlab, then run successively the scripts : 
   * `Attention_Neuron/mexScript.m`
   * `Attention_Neuron/runScriptDN.m`
   * `Intermediate_Layer/mexScript.m`
   * `Intermediate_Layer/runScriptL1.m`
   * `Output_Layer/mexScript.m`
   * `Output_Layer/runScriptL2.m`
3) To display the results, add the **drawingUtils** directory to the current path then run `plot_results.m`

### To run it automatically

1) Modify the line 27 of `AutoAttentionModel.sh` : replace with the path to the Matlab directory on your machine
2) Modify the line 8 of `AutoAttentionModel.sh` : currently the simulations runs 10 times, but you can adapt it to your needs
3) Modify the line 23 of `AutoAttentionModel.sh` : currently 6 different samples are concatenated, with the 5 first samples from the same category. Adapt this to your needs. 
4) Run `AutoAttentionModel.sh`
  
## Requirements
  
`Matlab` should be installed under the version 2018b at least. 
The script `transform_DVS_Gesture.py` requires the following Python libraries : 
- numpy
- csv
- tonic

## Preliminary results
Some preliminary results can be found in the **Results** directory. The format `.fig` can be opened using Matlab. 


## ReadMe produced by the authors of the original Matlab code, Bernert and Yvert (2019)

1)Organization

ANNet is designed to be run with Matlab. It is organized into three different parts that should be run one after the other, placed into three different sub-folders:
-Attention neuron : run the input layer and the attention neuron, takes the electrode signal as input.
-Intermediate Layer : run the input layer and the intermediate layer, takes the electrode signal and the attention neuron's output as input
-Output layer : run the output layer, takes the intermediate layer and the attention neuron as input

2)Input data
The input data should be a single electrode signal sample at 80kHz.
The Folder "data" contains an example of data saved in the correct format. It also contains a utility function able to save your data in the correct format. This function takes as input the signal samples in an horizontal vector, the sampling step of the data and the filename (string) to save it. the function will automatically resample the signal if necessary.
The data is saved as a mat file containing one variable named 'signal'. This variable is a structure containing the 4 following fields:
-data : a horizontal vector containing the data samples
-dt : the sampling step (should be 1/80000)
-nSignals : the number of recorded electrodes (should be 1)
-start : the start time of the recording (we advise to set this field at 0)

3)First use and demo

Before the first use you should mex the network functions. To do so you must have a C compiler compatible with Matlab installed on your computer. Go in each of the network folders (Attention Neuron, Intermediate Layer, Output Layer) and run mexScript.m.
On first use, the scripts are set to be run on the test data present in the data folder. To run the network proceed as follow:
-Go in the Attention Neuron folder and run the script "runScriptDN.m". It should generate a mat file named "ANTest_on_testData.mat" in the same folder. This file will be used by the next layers. 
-Go in the Intermediate Layer folder and run the script "runScriptL1.m". It should generate a mat file named "L1test_on_testData.mat", which will b used by the next layer.
-Go in the Output Layer folder and run the script "runScriptL2.m". It should generate a mat file named "L2test_on_testData.mat", which contains the final output of the network.

4)Output files and visualisation functions

The output file generated by each part of the network contains different types of variables:
-a spike train variable, which is the output spike train of the corresponding layer. It is a structure containing the following fields:
	-nNeurons: the number of neurons involved in the spike train
	-timeStamps: the time stamps of the spikes
	-neuronTags: same size as timeStamps, contains the number of the neurons which emitted each spike. 
-a variable named 'SIMU', which is a structure containing the parameters with which the network was run, as well as the history parameters.
-string variables reminding on which input was run this part of the network (see point 5).
-weight variables, containing the synaptic weight of the layer at the end of the simulation. It is a 1 x Nneur, where Nneur is the number of neurons in the layer. Each cell is a matrix containing the weight of the synapses arriving on one neuron.
-weight history variable, which containing a history of the weights durung the simulation. It is a Ntimes x Nneur matrix, where Ntimes is the number of time points in the history.
-other history variables, in the form of a Ntimes x Nneur vector.
The final output of the network is thus the spike train variable found in the output file generated by the Output Layer.
The folder "drawingUtils" contains functions to visualize these different variables.

5)Run ANNet on your own data

First, save your data in the required format (see point 2). We suggest to save your data in the "data" folder.
In the Attention Neuron folder, open "runScriptDN.m". 
In the first part of the script give the name of your input signal file ('inputFile'), and the folder in which it is saved ('inputFolder'). 
Chose a name for your simulation, and set it in 'AN_simu_name'. You can also change the folder in which the output is saved.
Similarly, in the runScriptL1 (Intermediate Layer) and runScriptL2 (Output Layer), give the name of the input signal file and its folder, give the name chosen for the previous layers' simulation and set a name for the simulation of this layer.
You can then run the scripts in the correct order, as for the demo (see point 3).
For each layer, you can change the history parameters and the network parameters in the "simuparameters.m" script.
